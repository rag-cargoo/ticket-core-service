<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TicketRush U1 Auth Console</title>
  <link rel="stylesheet" href="./app.css">
</head>
<body class="u1-body">
  <div class="u1-bg-shape u1-bg-shape-a"></div>
  <div class="u1-bg-shape u1-bg-shape-b"></div>
  <main class="u1-main">
    <header class="u1-hero">
      <p class="u1-kicker">UX Track U1</p>
      <h1>Auth + Reservation v7 MVP Console</h1>
      <p>One flow login, concert exploration, and signed reservation APIs from one page.</p>
    </header>

    <section class="u1-card">
      <h2>API Target</h2>
      <div class="u1-row">
        <label for="apiBaseInput">API Base URL</label>
        <input id="apiBaseInput" type="text" placeholder="http://127.0.0.1:8080">
        <button id="useCurrentOriginBtn" type="button" class="u1-btn u1-btn-ghost">Use Current Origin</button>
      </div>
      <p class="u1-hint">If this page is served by Spring Boot, current origin is recommended.</p>
    </section>

    <section class="u1-card">
      <h2>Session Snapshot</h2>
      <div class="u1-status-row">
        <span id="loginStatusBadge" class="u1-badge u1-badge-off">Logged Out</span>
        <button id="clearSessionBtn" type="button" class="u1-btn">Clear Local Session</button>
      </div>
      <div>
        <h3>Current User (/api/auth/me)</h3>
        <pre id="currentUserView" class="u1-user-view">-</pre>
      </div>
    </section>

    <section class="u1-card">
      <h2>How To Test (Quick Guide)</h2>
      <p class="u1-hint">Recommended E2E order: login -> concert/seat selection -> queue check -> reservation transition.</p>
      <ol class="u1-guide-steps">
        <li>Click <code>Use Current Origin</code> to keep API base aligned with this page.</li>
        <li>Run <code>Login with Kakao</code> or <code>Login with Naver</code> and confirm green action status.</li>
        <li>Click <code>Refresh Concerts</code>, select concert/option/AVAILABLE seat (Seat ID auto-filled).</li>
        <li>Use queue actions (<code>join/status/subscribe</code>) with auto-filled <code>userId</code> and <code>concertId</code>.</li>
        <li>Create hold and copy returned reservation id, then test <code>paying/confirm/cancel/refund</code>.</li>
      </ol>

      <div class="u1-guide-grid">
        <article class="u1-guide-box">
          <h3>Social Login Checkpoints</h3>
          <ul class="u1-guide-list">
            <li><code>Current User</code> should show <code>userId/provider/email</code>.</li>
            <li><code>Token Pair Check</code> should be <code>DIFFERENT (normal)</code>.</li>
            <li>Action status should show timestamp + green/red result immediately.</li>
          </ul>
        </article>
        <article class="u1-guide-box">
          <h3>Queue Input Example</h3>
          <ul class="u1-guide-list">
            <li><code>User ID</code>: leave empty to auto-use logged-in user.</li>
            <li><code>Concert ID</code>: leave empty after concert select for auto-fill.</li>
            <li><code>Queue Status</code>: expected <code>WAITING</code> then <code>ACTIVE</code>.</li>
          </ul>
        </article>
      </div>

      <details class="u1-guide-details">
        <summary>Reservation v7 Example Scenario</summary>
        <ol class="u1-guide-steps u1-guide-steps-compact">
          <li>Pick an <code>AVAILABLE</code> seat in explorer (fills <code>Seat ID</code>).</li>
          <li>Click <code>POST /v7/holds</code> and read <code>id</code> from Console.</li>
          <li>Paste that value into <code>Reservation ID</code> input.</li>
          <li>Run <code>POST /v7/{id}/paying</code> -> <code>POST /v7/{id}/confirm</code>.</li>
          <li>Verify with <code>GET /v7/{id}</code> or <code>GET /v7/me</code>.</li>
        </ol>
      </details>

      <details class="u1-guide-details">
        <summary>If Something Fails</summary>
        <ul class="u1-guide-list">
          <li>Red status with timeout/network error: backend URL is wrong or server is down.</li>
          <li><code>access token is empty</code>: login first or avoid clearing local session before API calls.</li>
          <li>Callback errors after login: check provider redirect URI and host consistency (<code>localhost</code> vs <code>127.0.0.1</code>).</li>
        </ul>
      </details>
    </section>

    <section class="u1-card">
      <h2>Social Login</h2>
      <div class="u1-actions">
        <button id="loginKakaoBtn" type="button" class="u1-btn u1-btn-primary">Login with Kakao</button>
        <button id="loginNaverBtn" type="button" class="u1-btn u1-btn-primary-alt">Login with Naver</button>
      </div>
      <p id="actionStatus" class="u1-action-status u1-action-info">Ready</p>
      <div class="u1-actions">
        <button id="meBtn" type="button" class="u1-btn">GET /api/auth/me</button>
        <button id="refreshBtn" type="button" class="u1-btn">POST /api/auth/token/refresh</button>
        <button id="logoutBtn" type="button" class="u1-btn u1-btn-warn">POST /api/auth/logout</button>
      </div>
      <div class="u1-token-grid">
        <div>
          <h3>Access Token State</h3>
          <code id="accessTokenView" class="u1-token-view">-</code>
        </div>
        <div>
          <h3>Refresh Token State</h3>
          <code id="refreshTokenView" class="u1-token-view">-</code>
        </div>
        <div>
          <h3>Token Pair Check</h3>
          <code id="tokenPairView" class="u1-token-view u1-token-neutral">-</code>
        </div>
      </div>
    </section>

    <section class="u1-card">
      <h2>Concert Explorer</h2>
      <div class="u1-form-grid">
        <div class="u1-field">
          <label for="concertSearchInput">Search</label>
          <input id="concertSearchInput" type="text" placeholder="title / artist / id">
        </div>
        <div class="u1-field">
          <label for="concertArtistFilter">Artist Filter</label>
          <select id="concertArtistFilter">
            <option value="all">All Artists</option>
          </select>
        </div>
        <div class="u1-field">
          <label for="concertSortSelect">Sort</label>
          <select id="concertSortSelect">
            <option value="title_asc">Title A to Z</option>
            <option value="title_desc">Title Z to A</option>
            <option value="artist_asc">Artist A to Z</option>
            <option value="artist_desc">Artist Z to A</option>
            <option value="id_desc">Latest ID</option>
            <option value="id_asc">Oldest ID</option>
          </select>
        </div>
        <div class="u1-field u1-field-actions">
          <button id="refreshConcertsBtn" type="button" class="u1-btn">Refresh Concerts</button>
          <label class="u1-check" for="seatAvailableOnlyCheck">
            <input id="seatAvailableOnlyCheck" type="checkbox" checked>
            Show AVAILABLE seats only
          </label>
        </div>
      </div>

      <p id="concertResultSummary" class="u1-hint">Load concerts to start exploring.</p>

      <div class="u1-explorer-grid">
        <section class="u1-subcard">
          <h3>Concerts</h3>
          <div id="concertList" class="u1-scroll-list"></div>
        </section>
        <section class="u1-subcard">
          <h3>Options</h3>
          <div id="optionList" class="u1-scroll-list"></div>
        </section>
        <section class="u1-subcard">
          <h3>Seats</h3>
          <div id="seatList" class="u1-scroll-list"></div>
        </section>
      </div>

      <p class="u1-hint">Selecting an AVAILABLE seat auto-fills <code>Seat ID</code> for reservation hold.</p>
    </section>

    <section class="u1-card">
      <h2>Waiting Queue (Step 7)</h2>
      <div class="u1-grid">
        <div class="u1-row">
          <label for="queueUserIdInput">User ID</label>
          <input id="queueUserIdInput" type="number" min="1" placeholder="auto from /api/auth/me">
        </div>
        <div class="u1-row">
          <label for="queueConcertIdInput">Concert ID</label>
          <input id="queueConcertIdInput" type="number" min="1" placeholder="auto from selected concert">
        </div>
      </div>
      <div class="u1-actions">
        <button id="queueJoinBtn" type="button" class="u1-btn">POST /api/v1/waiting-queue/join</button>
        <button id="queueStatusBtn" type="button" class="u1-btn">GET /api/v1/waiting-queue/status</button>
        <button id="queueSubscribeBtn" type="button" class="u1-btn">SSE /subscribe</button>
        <button id="queueUnsubscribeBtn" type="button" class="u1-btn u1-btn-ghost">Close SSE</button>
      </div>
      <p class="u1-hint">Queue APIs are open endpoints. Reservation v7 still requires authenticated access token.</p>
      <pre id="queueStateView" class="u1-user-view">-</pre>
    </section>

    <section class="u1-card">
      <h2>Reservation v7</h2>
      <div class="u1-grid">
        <div class="u1-row">
          <label for="seatIdInput">Seat ID</label>
          <input id="seatIdInput" type="number" min="1" placeholder="1">
          <button id="createHoldBtn" type="button" class="u1-btn">POST /v7/holds</button>
        </div>
        <div class="u1-row">
          <label for="reservationIdInput">Reservation ID</label>
          <input id="reservationIdInput" type="number" min="1" placeholder="Reservation ID from hold response">
        </div>
      </div>
      <div class="u1-actions">
        <button id="startPayingBtn" type="button" class="u1-btn">POST /v7/{id}/paying</button>
        <button id="confirmBtn" type="button" class="u1-btn">POST /v7/{id}/confirm</button>
        <button id="cancelBtn" type="button" class="u1-btn">POST /v7/{id}/cancel</button>
        <button id="refundBtn" type="button" class="u1-btn">POST /v7/{id}/refund</button>
      </div>
      <div class="u1-actions">
        <button id="getReservationBtn" type="button" class="u1-btn">GET /v7/{id}</button>
        <button id="getMyReservationsBtn" type="button" class="u1-btn">GET /v7/me</button>
      </div>
    </section>

    <section class="u1-card">
      <h2>Console</h2>
      <pre id="consoleView" class="u1-console"></pre>
    </section>
  </main>

  <script src="./app.js"></script>
</body>
</html>
