<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TicketRush U1 Auth Console</title>
  <link rel="stylesheet" href="./app.css">
</head>
<body class="u1-body">
  <div class="u1-bg-shape u1-bg-shape-a"></div>
  <div class="u1-bg-shape u1-bg-shape-b"></div>
  <main class="u1-main">
    <header class="u1-hero">
      <p class="u1-kicker">UX Track U1</p>
      <h1>Auth + Reservation v7 MVP Console</h1>
      <p>One flow login, concert exploration, and signed reservation APIs from one page.</p>
    </header>

    <section class="u1-card">
      <h2>API Target</h2>
      <div class="u1-row">
        <label for="apiBaseInput">API Base URL</label>
        <input id="apiBaseInput" type="text" placeholder="http://127.0.0.1:8080">
        <button id="useCurrentOriginBtn" type="button" class="u1-btn u1-btn-ghost">Use Current Origin</button>
      </div>
      <p class="u1-hint">If this page is served by Spring Boot, current origin is recommended.</p>
    </section>

    <section class="u1-card">
      <h2>Session Snapshot</h2>
      <div class="u1-status-row">
        <span id="loginStatusBadge" class="u1-badge u1-badge-off">Logged Out</span>
        <button id="clearSessionBtn" type="button" class="u1-btn">Clear Local Session</button>
      </div>
      <div>
        <h3>Current User (/api/auth/me)</h3>
        <pre id="currentUserView" class="u1-user-view">-</pre>
      </div>
    </section>

    <section class="u1-card">
      <h2>테스트 가이드 (빠른 시작)</h2>
      <p class="u1-hint">권장 순서: 로그인 -> 공연/좌석 선택 -> 대기열 확인 -> 예약 상태 전이</p>
      <ol class="u1-guide-steps">
        <li><code>Use Current Origin</code>을 눌러 API Base URL을 현재 페이지 주소로 맞춥니다.</li>
        <li><code>Login with Kakao</code> 또는 <code>Login with Naver</code>를 눌러 로그인합니다.</li>
        <li><code>Refresh Concerts</code> 후 공연/옵션/AVAILABLE 좌석을 선택합니다(Seat ID 자동입력).</li>
        <li>대기열 버튼(<code>join/status/subscribe</code>)으로 순번 상태를 확인합니다.</li>
        <li><code>POST /v7/holds</code> -> <code>paying/confirm/cancel/refund</code> 순으로 예약 상태를 테스트합니다.</li>
      </ol>

      <article class="u1-guide-box">
        <h3>원클릭 테스트 입력값 (더미)</h3>
        <p class="u1-hint">아래 값은 자유롭게 수정 가능합니다. <code>샘플값 적용</code>을 누르면 본문 입력칸에 반영되고 공연 목록을 다시 조회합니다.</p>
        <div class="u1-guide-form">
          <div class="u1-field">
            <label for="sampleApiBaseInput">API Base URL 샘플</label>
            <input id="sampleApiBaseInput" type="text" value="http://localhost:8080">
          </div>
          <div class="u1-field">
            <label for="sampleQueueUserIdInput">Queue User ID 샘플</label>
            <input id="sampleQueueUserIdInput" type="number" min="1" value="1">
          </div>
          <div class="u1-field">
            <label for="sampleQueueConcertIdInput">Queue Concert ID 샘플</label>
            <input id="sampleQueueConcertIdInput" type="number" min="1" value="1">
          </div>
          <div class="u1-field">
            <label for="sampleSeatIdInput">Seat ID 샘플</label>
            <input id="sampleSeatIdInput" type="number" min="1" value="1">
          </div>
          <div class="u1-field">
            <label for="sampleReservationIdInput">Reservation ID 샘플</label>
            <input id="sampleReservationIdInput" type="number" min="1" value="1">
          </div>
          <div class="u1-field">
            <label for="sampleSearchInput">콘서트 검색어 샘플</label>
            <input id="sampleSearchInput" type="text" placeholder="예: IU / NewJeans / 1">
          </div>
        </div>
        <div class="u1-actions">
          <button id="applySampleValuesBtn" type="button" class="u1-btn u1-btn-primary">샘플값 적용</button>
          <button id="resetSampleValuesBtn" type="button" class="u1-btn u1-btn-ghost">샘플값 초기화</button>
        </div>
      </article>

      <div class="u1-guide-grid">
        <article class="u1-guide-box">
          <h3>소셜 로그인 체크포인트</h3>
          <ul class="u1-guide-list">
            <li><code>Current User</code>에 <code>userId/provider/email</code>이 보이면 정상입니다.</li>
            <li><code>Token Pair Check</code>는 <code>DIFFERENT (normal)</code>이 정상입니다.</li>
            <li>상태 메시지는 시간 + 초록(성공)/빨강(실패)으로 즉시 표시됩니다.</li>
          </ul>
        </article>
        <article class="u1-guide-box">
          <h3>대기열 입력 예시</h3>
          <ul class="u1-guide-list">
            <li><code>User ID</code>를 비우면 로그인 사용자 ID를 자동으로 사용합니다.</li>
            <li><code>Concert ID</code>를 비우면 선택된 콘서트 ID를 자동으로 사용합니다.</li>
            <li><code>Queue Status</code>는 일반적으로 <code>WAITING</code> -> <code>ACTIVE</code> 순서로 변경됩니다.</li>
          </ul>
        </article>
      </div>

      <details class="u1-guide-details">
        <summary>Reservation v7 예시 시나리오</summary>
        <ol class="u1-guide-steps u1-guide-steps-compact">
          <li>Explorer에서 <code>AVAILABLE</code> 좌석을 선택합니다(Seat ID 자동입력).</li>
          <li><code>POST /v7/holds</code>를 누르고 Console의 <code>id</code>를 확인합니다.</li>
          <li>확인한 값을 <code>Reservation ID</code> 입력칸에 넣습니다.</li>
          <li><code>POST /v7/{id}/paying</code> -> <code>POST /v7/{id}/confirm</code> 순서로 실행합니다.</li>
          <li><code>GET /v7/{id}</code> 또는 <code>GET /v7/me</code>로 결과를 확인합니다.</li>
        </ol>
      </details>

      <details class="u1-guide-details">
        <summary>실패했을 때 확인할 것</summary>
        <ul class="u1-guide-list">
          <li>timeout/network 오류: API Base URL 오입력 또는 백엔드 미기동 가능성이 큽니다.</li>
          <li><code>access token is empty</code>: 먼저 소셜 로그인 후 다시 시도하세요.</li>
          <li>callback 오류: provider redirect URI 설정과 호스트(<code>localhost</code>/<code>127.0.0.1</code>) 일치 여부를 확인하세요.</li>
        </ul>
      </details>
    </section>

    <section class="u1-card">
      <h2>Social Login</h2>
      <div class="u1-actions">
        <button id="loginKakaoBtn" type="button" class="u1-btn u1-btn-primary">Login with Kakao</button>
        <button id="loginNaverBtn" type="button" class="u1-btn u1-btn-primary-alt">Login with Naver</button>
      </div>
      <p id="actionStatus" class="u1-action-status u1-action-info">Ready</p>
      <div class="u1-actions">
        <button id="meBtn" type="button" class="u1-btn">GET /api/auth/me</button>
        <button id="refreshBtn" type="button" class="u1-btn">POST /api/auth/token/refresh</button>
        <button id="logoutBtn" type="button" class="u1-btn u1-btn-warn">POST /api/auth/logout</button>
      </div>
      <div class="u1-token-grid">
        <div>
          <h3>Access Token State</h3>
          <code id="accessTokenView" class="u1-token-view">-</code>
        </div>
        <div>
          <h3>Refresh Token State</h3>
          <code id="refreshTokenView" class="u1-token-view">-</code>
        </div>
        <div>
          <h3>Token Pair Check</h3>
          <code id="tokenPairView" class="u1-token-view u1-token-neutral">-</code>
        </div>
      </div>
    </section>

    <section class="u1-card">
      <h2>Concert Explorer</h2>
      <article class="u1-setup-box">
        <h3>Concert Setup (Admin/Test)</h3>
        <p class="u1-hint">테스트용 공연/옵션/좌석을 한 번에 생성합니다. 생성 후 Explorer 목록이 자동 갱신됩니다.</p>
        <div class="u1-form-grid u1-form-grid-setup">
          <div class="u1-field">
            <label for="concertSetupTitleInput">Title</label>
            <input id="concertSetupTitleInput" type="text" placeholder="예: Test Concert">
          </div>
          <div class="u1-field">
            <label for="concertSetupArtistInput">Artist Name</label>
            <input id="concertSetupArtistInput" type="text" placeholder="예: Test Artist">
          </div>
          <div class="u1-field">
            <label for="concertSetupArtistDisplayInput">Artist Display Name (optional)</label>
            <input id="concertSetupArtistDisplayInput" type="text" placeholder="예: NewJeans">
          </div>
          <div class="u1-field">
            <label for="concertSetupArtistGenreInput">Artist Genre (optional)</label>
            <input id="concertSetupArtistGenreInput" type="text" placeholder="예: K-POP">
          </div>
          <div class="u1-field">
            <label for="concertSetupArtistDebutDateInput">Artist Debut Date (optional)</label>
            <input id="concertSetupArtistDebutDateInput" type="date">
          </div>
          <div class="u1-field">
            <label for="concertSetupEntertainmentInput">Entertainment Name</label>
            <input id="concertSetupEntertainmentInput" type="text" placeholder="예: Test Entertainment">
          </div>
          <div class="u1-field">
            <label for="concertSetupEntertainmentCountryCodeInput">Entertainment Country Code (optional)</label>
            <input id="concertSetupEntertainmentCountryCodeInput" type="text" maxlength="2" placeholder="예: KR">
          </div>
          <div class="u1-field">
            <label for="concertSetupEntertainmentHomepageInput">Entertainment Homepage URL (optional)</label>
            <input id="concertSetupEntertainmentHomepageInput" type="text" placeholder="예: https://entertainment.example.com">
          </div>
          <div class="u1-field">
            <label for="concertSetupDateInput">Concert Date/Time</label>
            <input id="concertSetupDateInput" type="datetime-local">
          </div>
          <div class="u1-field">
            <label for="concertSetupSeatCountInput">Seat Count</label>
            <input id="concertSetupSeatCountInput" type="number" min="1" step="1" value="30">
          </div>
        </div>
        <div class="u1-actions">
          <button id="concertSetupCreateBtn" type="button" class="u1-btn u1-btn-primary">POST /api/concerts/setup</button>
          <button id="concertSetupResetBtn" type="button" class="u1-btn u1-btn-ghost">Reset Setup Form</button>
        </div>
      </article>

      <div class="u1-form-grid">
        <div class="u1-field">
          <label for="concertSearchInput">Search</label>
          <input id="concertSearchInput" type="text" placeholder="title / artist / id">
        </div>
        <div class="u1-field">
          <label for="concertArtistFilter">Artist Filter</label>
          <select id="concertArtistFilter">
            <option value="all">All Artists</option>
          </select>
        </div>
        <div class="u1-field">
          <label for="concertEntertainmentFilterInput">Entertainment Filter (optional)</label>
          <input id="concertEntertainmentFilterInput" type="text" placeholder="entertainmentName exact match">
        </div>
        <div class="u1-field">
          <label for="concertSortSelect">Sort</label>
          <select id="concertSortSelect">
            <option value="title_asc">Title A to Z</option>
            <option value="title_desc">Title Z to A</option>
            <option value="artist_asc">Artist A to Z</option>
            <option value="artist_desc">Artist Z to A</option>
            <option value="entertainment_asc">Entertainment A to Z</option>
            <option value="entertainment_desc">Entertainment Z to A</option>
            <option value="id_desc">Latest ID</option>
            <option value="id_asc">Oldest ID</option>
          </select>
        </div>
        <div class="u1-field u1-field-actions">
          <button id="refreshConcertsBtn" type="button" class="u1-btn">Refresh Concerts</button>
          <label class="u1-check" for="seatAvailableOnlyCheck">
            <input id="seatAvailableOnlyCheck" type="checkbox" checked>
            Show AVAILABLE seats only
          </label>
        </div>
      </div>

      <div class="u1-pagination-row">
        <button id="concertPrevPageBtn" type="button" class="u1-btn u1-btn-ghost" disabled>Prev Page</button>
        <span id="concertPageInfo" class="u1-hint">Page -/-</span>
        <button id="concertNextPageBtn" type="button" class="u1-btn u1-btn-ghost" disabled>Next Page</button>
      </div>

      <p id="concertResultSummary" class="u1-hint">Load concerts to start exploring.</p>

      <div class="u1-explorer-grid">
        <section class="u1-subcard">
          <h3>Concerts</h3>
          <div id="concertList" class="u1-scroll-list"></div>
        </section>
        <section class="u1-subcard">
          <h3>Options</h3>
          <div id="optionList" class="u1-scroll-list"></div>
        </section>
        <section class="u1-subcard">
          <h3>Seats</h3>
          <div id="seatList" class="u1-scroll-list"></div>
        </section>
      </div>

      <p class="u1-hint">Selecting an AVAILABLE seat auto-fills <code>Seat ID</code> for reservation hold.</p>
    </section>

    <section class="u1-card">
      <h2>Waiting Queue (Step 7)</h2>
      <div class="u1-grid">
        <div class="u1-row">
          <label for="queueUserIdInput">User ID</label>
          <input id="queueUserIdInput" type="number" min="1" placeholder="auto from /api/auth/me">
        </div>
        <div class="u1-row">
          <label for="queueConcertIdInput">Concert ID</label>
          <input id="queueConcertIdInput" type="number" min="1" placeholder="auto from selected concert">
        </div>
      </div>
      <div class="u1-actions">
        <button id="queueJoinBtn" type="button" class="u1-btn">POST /api/v1/waiting-queue/join</button>
        <button id="queueStatusBtn" type="button" class="u1-btn">GET /api/v1/waiting-queue/status</button>
        <button id="queueSubscribeBtn" type="button" class="u1-btn">SSE /subscribe</button>
        <button id="queueUnsubscribeBtn" type="button" class="u1-btn u1-btn-ghost">Close SSE</button>
      </div>
      <p class="u1-hint">Queue APIs are open endpoints. Reservation v7 still requires authenticated access token.</p>
      <pre id="queueStateView" class="u1-user-view">-</pre>
    </section>

    <section class="u1-card">
      <h2>Reservation v7</h2>
      <div class="u1-grid">
        <div class="u1-row">
          <label for="seatIdInput">Seat ID</label>
          <input id="seatIdInput" type="number" min="1" placeholder="1">
          <button id="createHoldBtn" type="button" class="u1-btn">POST /v7/holds</button>
        </div>
        <div class="u1-row">
          <label for="reservationIdInput">Reservation ID</label>
          <input id="reservationIdInput" type="number" min="1" placeholder="Reservation ID from hold response">
        </div>
      </div>
      <div class="u1-actions">
        <button id="startPayingBtn" type="button" class="u1-btn">POST /v7/{id}/paying</button>
        <button id="confirmBtn" type="button" class="u1-btn">POST /v7/{id}/confirm</button>
        <button id="cancelBtn" type="button" class="u1-btn">POST /v7/{id}/cancel</button>
        <button id="refundBtn" type="button" class="u1-btn">POST /v7/{id}/refund</button>
      </div>
      <div class="u1-actions">
        <button id="getReservationBtn" type="button" class="u1-btn">GET /v7/{id}</button>
        <button id="getMyReservationsBtn" type="button" class="u1-btn">GET /v7/me</button>
      </div>
    </section>

    <section class="u1-card">
      <h2>Console</h2>
      <pre id="consoleView" class="u1-console"></pre>
    </section>
  </main>

  <script src="./app.js"></script>
</body>
</html>
