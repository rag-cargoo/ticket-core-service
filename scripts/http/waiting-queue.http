@host = http://localhost:8080
@ts = {{$timestamp}}

### 1) 테스트 유저 생성
POST {{host}}/api/users
Content-Type: application/json

{
  "username": "waiting-{{ts}}",
  "tier": "BASIC"
}
> {%
client.test("waiting user created", function() {
  client.assert(response.status === 200, "expected 200");
  client.assert(response.body && response.body.id, "user id missing");
});
client.global.set("waitingUserId", String(response.body.id));
%}

### 2) 테스트 공연 생성
POST {{host}}/api/concerts/setup
Content-Type: application/json

{
  "title": "Waiting-Queue-{{ts}}",
  "artistName": "Waiting-Artist-{{ts}}",
  "agencyName": "Waiting-Agency-{{ts}}",
  "concertDate": "2026-06-01T18:00:00",
  "seatCount": 50
}
> {%
const body = typeof response.body === "string" ? response.body : String(response.body);
const concertMatch = body.match(/ConcertID=(\d+)/);
if (concertMatch) {
  client.global.set("waitingConcertId", concertMatch[1]);
}
%}

### 3) 대기열 진입
POST {{host}}/api/v1/waiting-queue/join
Content-Type: application/json

{
  "userId": {{waitingUserId}},
  "concertId": {{waitingConcertId}}
}

### 4) 대기 상태 조회
GET {{host}}/api/v1/waiting-queue/status?userId={{waitingUserId}}&concertId={{waitingConcertId}}

### 5) SSE 순번 구독 (Step 7)
GET {{host}}/api/v1/waiting-queue/subscribe?userId={{waitingUserId}}&concertId={{waitingConcertId}}
Accept: text/event-stream

### 6) WebSocket 순번 구독 등록 (Step 7, mode=websocket)
POST {{host}}/api/push/websocket/waiting-queue/subscriptions
Content-Type: application/json

{
  "userId": {{waitingUserId}},
  "concertId": {{waitingConcertId}}
}

### 7) WebSocket 순번 구독 해제
DELETE {{host}}/api/push/websocket/waiting-queue/subscriptions?userId={{waitingUserId}}&concertId={{waitingConcertId}}

### 8) 정리 - 테스트 유저 삭제
DELETE {{host}}/api/users/{{waitingUserId}}

### 9) 정리 - 테스트 공연 삭제
DELETE {{host}}/api/concerts/cleanup/{{waitingConcertId}}
