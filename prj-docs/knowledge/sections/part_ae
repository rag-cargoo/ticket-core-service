```java
// [Controller]
@PostMapping("/v4/queue")
public ResponseEntity<String> createAsyncReservation(@RequestBody ReservationRequest request) {
    // 1. Redisì— ì´ˆê¸° ìƒíƒœ ì €ì¥
    queueService.setStatus(request.userId(), request.seatId(), "PENDING");
    
    // 2. Kafkaë¡œ ì´ë²¤íŠ¸ ë°œí–‰ (ì¦‰ì‹œ ë¦¬í„´)
    kafkaProducer.send(ReservationEvent.of(request.userId(), request.seatId(), OPTIMISTIC));
    
    return ResponseEntity.accepted().body("Request Enqueued");
}
```

---

### 3. ì ìš© ë°©ë²• (Step-by-Step Implementation)

ë¹„ë™ê¸° ì „í™˜ì„ ìœ„í•œ 3ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

1.  **íŒŒë¼ë¯¸í„°ì˜ ì´ë²¤íŠ¸í™”**: ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë°›ë˜ DTO ë°ì´í„°(`userId`, `seatId`)ë¥¼ Kafka ì „ì†¡ìš© ê°ì²´ì¸ `ReservationEvent`ë¡œ ìº¡ìŠí™”í•©ë‹ˆë‹¤.
2.  **í”„ë¡œë“€ì„œ(Producer) ì—°ë™**: ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `ReservationService` ì˜ì¡´ì„±ì„ ì œê±°í•˜ê³ , ëŒ€ì‹  `KafkaReservationProducer`ë¥¼ ì£¼ì…ë°›ì•„ ì´ë²¤íŠ¸ë¥¼ ë°œí–‰í•˜ë„ë¡ ìˆ˜ì •í•©ë‹ˆë‹¤.
3.  **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì´ê´€ (Consumer)**: ê¸°ì¡´ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìˆ˜í–‰í•˜ë˜ `reservationService.create...()` í˜¸ì¶œ ì½”ë“œë¥¼ `KafkaReservationConsumer`ì˜ `@KafkaListener` ë©”ì„œë“œ ë‚´ë¶€ë¡œ ì˜®ê¹ë‹ˆë‹¤. ì´ë•Œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ **SSE(SseEmitterManager)**ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì— í†µë³´í•˜ë„ë¡ ì—°ê²°í•©ë‹ˆë‹¤.

---

### 4. í•µì‹¬ ì„¤ê³„ ê²°ì • ë° ì •í•©ì„± ë³´ì¥ (ADR)

| ê²°ì • ì‚¬í•­ | ì„¤ê³„ ë‚´ìš© | ê³µí•™ì  ì´ìœ  |
| :--- | :--- | :--- |
| **Partition Key** | `seatId` | ë™ì¼ ì¢Œì„ì— ëŒ€í•œ ê²½í•©ì„ ë‹¨ì¼ ì»¨ìŠˆë¨¸ ìŠ¤ë ˆë“œì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•¨ (ë¬¼ë¦¬ì  ìˆœì„œ ë³´ì¥) |
| **Status Store** | Redis | ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘ ì‚¬ìš©ìê°€ ì–¸ì œë“  ìƒíƒœë¥¼ ì¡°íšŒ(`Polling`)í•  ìˆ˜ ìˆë„ë¡ ì´ˆê³ ì† ì €ì¥ì†Œ í™œìš© |
| **Notification** | SSE | í´ë§ì— ì˜í•œ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ì¤„ì´ê³  ì‚¬ìš©ìì—ê²Œ ì¦‰ê°ì ì¸ ë‹¹ì²¨ ê²½í—˜ ì œê³µ |

---

### 4. ì ìš© íš¨ê³¼ (Experimental Results)
- **ìì› íš¨ìœ¨**: DB ì»¤ë„¥ì…˜ì„ ì ìœ í•˜ë©° ëŒ€ê¸°í•˜ëŠ” ìŠ¤ë ˆë“œê°€ ì‚¬ë¼ì§ (ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ ë°©ì§€).
- **ì‚¬ìš©ì ê²½í—˜**: "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”"ë¼ëŠ” í”¼ë“œë°±ê³¼ í•¨ê»˜ ì‹¤ì‹œê°„ìœ¼ë¡œ ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°›ê²Œ ë¨.
- **ì•ˆì •ì„±**: ì´ˆë‹¹ 1ë§Œ ê±´ì˜ ìš”ì²­ì´ ë“¤ì–´ì™€ë„ Kafkaê°€ ì™„ì¶© ì‘ìš©ì„ í•˜ì—¬ ì„œë²„ê°€ ì£½ì§€ ì•ŠìŒ.

---

## ğŸš€ í–¥í›„ ê³¼ì œ: ì§„ì •í•œ "ê¸°ë‹¤ë¦¼"ì˜ ë¯¸í•™

ì§€ê¸ˆê¹Œì§€ì˜ êµ¬í˜„ì€ "ë¹„ë™ê¸° ì²˜ë¦¬"ì— ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ì—ì„œëŠ” ì‚¬ìš©ìì—ê²Œ ì§„ì •í•œ ëŒ€ê¸° ìˆœë²ˆì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œìœ¼ë¡œ ì§„í™”í•©ë‹ˆë‹¤.

- **Step 5: Redis Sorted Set ê¸°ë°˜ ëŒ€ê¸°ì—´**
  - "ë‚´ ì•ì— ëª‡ ëª…ì´ ë‚¨ì•˜ëŠ”ì§€" ì‹¤ì‹œê°„ ìˆœë²ˆ ì œê³µ.
  - íŠ¸ë˜í”½ ê³¼ë¶€í•˜ ì‹œ ì‹œìŠ¤í…œ ì§„ì… ìì²´ë¥¼ ì œì–´í•˜ëŠ” Throttling êµ¬í˜„.

---

> **Next Step**: Phase 3.5 - Redis Sorted Setì„ ì´ìš©í•œ ì‹¤ì‹œê°„ ëŒ€ê¸° ìˆœë²ˆ í”¼ë“œë°± ì‹œìŠ¤í…œ êµ¬í˜„ ì‹œì‘.